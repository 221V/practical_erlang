# Инфраструктура: OTP фреймворк и rebar

OTP фреймворк важная часть эрланг. Настолько важная, что язык на самом
деле называется не просто Erlang, а Erlang/OTP. Проекты на эрланг без
использования OTP встречаются крайне редко, и обычно это небольшие
библиотеки.

Рассмотренные на предыдущих уроках gen\_server, supervisor и
application являются частью OTP.

OTP -- это аббревиатура, которая читается как Open Telecom Platform.
То есть, платформа для создания проектов в области Telecom.  Название
не совсем правильное, на самом деле это платформа общего назначения,
для создания любых проектов.

OTP включает:
- приложения, формирующие базовое окружение: kernel, stdlib, erts, sasl;
- другие приложения, реализующие полезные функции: crypto, ssh, ssl, mnesia, wx, xmerl;
- поведения: gen\_server, supervisor, application, gen\_fms, gen\_event;
- ряд библиотек: lists, dict, maps, rand, re, timer и другие;
- инструменты для работы над проектом: компилятор, отладчик, профилировщик, статический анализатор, генератор документации.

За 20 лет своего существования OTP проверен во многих
высоконагруженных и распределенных проектах. Так что гораздо лучше
полагаться на уже имеющиеся средства: gen\_server, supervisor,
библиотеки и т.д., чем пытаться реализовать свои аналогичные.


## Типичная структура проекта

Для эрланг есть рекомендуемая структура проекта. На эту структуру расчитаны
инструменты, входящие в состав OTP. В первую очередь компилятор, и скрипты,
собирающие релизы.


### Минимальная структура

```
├─ ebin
│  ├── my_app.src
│  └── my_app.beam
└─ src
   └── my_app.erl
```

Самый простой OTP проект может иметь только две папки:
**src** для исходников и **ebin** для скомпилированных модулей.
В ebin также находится и файл ресурсов приложения.


### Проект из одного приложения

```
├─ ebin
│  ├── my_app.src
│  └── my_app.beam
├─ include
│  └── my_app.hrl
├─ priv
│  └── some.resource
└─ src
   └── my_app.erl
```

Кроме этого к стандартным папкам еще относятся:
**include** для заголовочных файлов,
**priv** для хранения каких-либо ресурсов, необходимых проекту
(файлы с данными, ssl-сертификаты, схемы валидации и т.д.)
и **docs** для документации, сгенерированной инструментом EDoc.


### Проект с использованием rebar

Популярный инструмент для управления зависимостями и сборки проекта
**rebar** добавляет к этой структуре еще несколько папок.  Они не
упоминаются в рекомендациях OTP, но часто встречаются в проектах, где
используется rebar.

```
├─ deps
├─ ebin
├─ .eunit
├─ include
├─ logs
├─ priv
├─ src
└─ test
```

Тут появляется папка **deps**, куда rebar скачивает зависимости.
И 3 папки, связанные с тестированием:
**test** для хранения тестов (eunit и common test),
**.eunit**, куда складываются скомпилированные модули и тесты,
и **logs** куда складываются отчеты.

Также в корне проекта появляется файл **rebar.config**, с описанием
параметров сборки, зависимостей и прочего. (Подробнее о rebar
и его конфигурации ниже).

Ну и хорошим тоном считается иметь в корне проекта файл **README**,
где кратко (ну или подробно) описать суть проекта.


### Проект из нескольких приложений

В более сложном случае проект может состоять из нескольких приложений.
И тогда структура его меняется

```
├─ deps
├─ app1
│  ├── ebin
│  ├── include
│  ├── logs
│  ├── priv
│  ├── src
│  └── test
├─ app2
│  ├── ebin
│  ├── include
│  ├── logs
│  ├── priv
│  ├── src
│  └── test
└─ appN
│  ├── ebin
│  ├── include
│  ├── logs
│  ├── priv
│  ├── src
│  └── test
├── rebar.config
└── README
```

Каждое приложение имеет свой собственный набор папко, кроме **deps**.
**deps** остается одна на весь проект.


### Еще в проекте могут быть


#### Конфигурационные файлы

Стандарты OTP не определяют, где должны быть конфигурационные
файлы. Они могут быть в корне проекта, или в папке priv.  Чаще
все-таки в корне проекта.


#### Исходники на других языках

Не редко проекты пишутся с использованием сразу нескольких языков
программирования.  И эрланг-проекты тоже могут иметь исходники на
других языках.  Стандарта на этот счет нет, но есть сложившаяся
практика помещать такие исходники в папки **c_src**, **cpp_src**,
**python_src** и т.д. на одном уровне с папкой **src**, то есть, на
уровне приложения.


#### Файлы веб-сервера

Проект на эрланг может быть веб-проектом. И тогда нужно где-то
хранить веб-ресурсы: html, js, css файлы и графику.

OTP предлагает хранить ресурсы в папке **priv**. Но обычно корневым
каталогом для веб-сервера делают не саму папку **priv**, а
какую-нибудь вложенную:

```
└─ priv
   └─ www
      ├─ css
      ├─ img
      ├─ js
      └─ index.html
```


## rebar

rebar.config

modules - Contains a list of all the modules that your application introduces to the system.
поддерживать это вручную неудобно, поэтому
src/some.app.src
rebar генерирует ebin/some.app

проблемы в управлении зависимостями

rebar3
